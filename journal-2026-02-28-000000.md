# Session Journal — 2026-02-28

## Session Goal
Implement Chunk 1 — Project Setup & Infrastructure for rbar.

Plan approved last session. Implementing in order:
1. Initialize Next.js 15 app
2. Initialize shadcn/ui
3. Install Prisma
4. Create Prisma client singleton
5. Create docker-compose.dev.yml
6. Create .env.example + .env.local
7. Create Dockerfile (production)
8. Create docker-compose.prod.yml
9. Create Nginx config
10. Create GitHub Actions CI pipeline
11. Update .gitignore
12. Update README.md
13. Create docs/chunks/chunk-01-infrastructure.md
14. Run all validation steps

---

## Entries

### Start
Resumed from previous session plan. Project has a folder skeleton but no Next.js app. Starting implementation.

### Chunk 1 Complete
All implementation steps executed and validated. Committed and pushed to GitHub.

**Issues encountered and resolved:**
1. `npx` not on PATH — Node.js wasn't installed. Installed Node 20 via Homebrew (`/usr/local/opt/node@20/bin`).
2. `create-next-app` refused to init in non-empty dir — initialized in temp dir `/tmp/rbar-init/rbar-app`, then copied files over.
3. Copied `node_modules` had broken bin shims — deleted and ran `npm install` fresh.
4. Prisma 7 (installed by default) broke `schema.prisma` URL config — downgraded to Prisma 5 (^5.22.0).

**Validation results:**
- ✅ `npm run lint` — passed (0 errors)
- ✅ `npx tsc --noEmit` — passed (0 type errors)
- ✅ `npm run build` — standalone build succeeded
- ✅ `docker compose -f docker-compose.dev.yml up -d` — PostgreSQL 16 + PostGIS container started healthy
- ✅ `npx prisma db push` — schema applied to local DB successfully
- ✅ `npm run dev` — started on localhost:3000 successfully
- ✅ `.env.local` in `.gitignore` — confirmed
- ✅ `docker build -t rbar-test .` — production image built successfully (multi-stage)

**All validations passed.** Docker Desktop installed via Homebrew.

**Next session:** Chunk 2 — Database Schema Design. See `docs/chunks/chunk-02-handoff.md` for full context.

### Session Closed
All notes written, memory updated, handoff doc created. Safe to exit.

---

## Chunk 2 — Database Schema Design

### Start
Implementing Chunk 2 per approved plan. Starting from working Next.js 15 + PostgreSQL dev DB (Chunk 1 baseline).

### Chunk 2 Complete
All implementation steps executed and all validations passed.

**Steps executed:**
1. Wrote full `prisma/schema.prisma` — 7 enums, 18 models
2. Generated migration SQL via `prisma migrate diff --from-empty --to-schema-datamodel`
3. Created `prisma/migrations/20260228000000_init_schema/migration.sql` with PostGIS extension prepended
4. Applied migration via `prisma migrate reset --force` (dev DB had old Chunk 1 `db push` state)
5. Wrote `prisma/seed.ts` with 5 leagues and 154 teams (hardcoded, no external API)
6. Registered seed in `package.json` via `prisma.seed` key
7. Ran `npx prisma db seed` — seeded successfully

**Issues encountered and resolved:**
1. `prisma migrate dev` is interactive — cannot run non-interactively. Used `prisma migrate diff` to generate SQL, created migration file manually, then used `prisma migrate reset --force` to apply fresh.
2. Seed initially used `upsert` but `shortName`/`abbreviation` aren't `@unique` in schema. Switched to `deleteMany` + `createMany` approach.

**Validation results:**
- ✅ `prisma migrate status` — up to date
- ✅ `\dt` — 18 domain tables
- ✅ PostGIS extension present
- ✅ Leagues: 5 rows
- ✅ Teams: 154 rows (NFL:32, NBA:30, MLB:30, NHL:32, MLS:30)
- ✅ NFL spot-check query — returns Cardinals, Falcons, Ravens
- ✅ `Venue_status_idx` index present
- ✅ `npx tsc --noEmit` — 0 type errors
- ✅ `npm run lint` — 0 errors

**All validations passed.**

**Next session:** Chunk 3 — Sports Data Integration.
