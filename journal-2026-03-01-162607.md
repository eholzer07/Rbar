# Session Journal â€” 2026-03-01

## Chunk 12 â€” Notifications & Alerts

### Scope
In-app notification system (foundation for email/push later):
- Notification model (schema + migration)
- Bell icon in nav with unread count
- /notifications page (auto-mark-read on visit)
- FOLLOW notification trigger (followAction)
- WATCH_EVENT_RSVP notification trigger (rsvpAction, first GOING only)

### Deferred
- Email notifications (needs email provider â€” Chunk 5a)
- Game day reminders (needs cron/scheduler â€” Chunk 16)
- Push notifications (Chunk 17 / mobile)
- Check-in proximity prompt (browser geolocation)
- Venue found / Submission status (triggered from admin actions â€” Chunk 13)

### Work Log

### Completed

1. **prisma/schema.prisma** â€” Added `NotificationType` enum (FOLLOW, WATCH_EVENT_RSVP) and `Notification` model (userId, type, title, body?, isRead, referenceUrl?, createdAt). Added `notifications Notification[]` to User. Indexes on `[userId, isRead]` and `[userId, createdAt]`.
2. **prisma/migrations/20260301000001_add_notification/migration.sql** â€” Manual migration file. Run `npx prisma migrate deploy` locally after `docker compose up -d`.
3. **`npx prisma generate`** â€” Client regenerated with new model.
4. **src/components/notification-bell.tsx** â€” Async server component; fetches unread count, renders "Alerts" link with red badge. Returns null if no session.
5. **src/app/layout.tsx** â€” Imported and added `<NotificationBell />` between Feed and Profile in nav.
6. **src/app/notifications/page.tsx** â€” Lists last 50 notifications desc. Auto-marks all unread as read on visit. Type icons (ðŸ‘¤ FOLLOW, âœ… RSVP). Clickable items if referenceUrl set. Blue dot on unread (pre-read state captured before update).
7. **src/middleware.ts** â€” `/notifications` added to protected paths.
8. **src/app/users/[username]/actions.ts** â€” `followAction` updated: checks `existing` before upsert; creates FOLLOW notification only on new follows. Fetches follower name+username from DB for notification content.
9. **src/app/watch-events/[id]/actions.ts** â€” `rsvpAction` updated: checks `existing` status before upsert; creates WATCH_EVENT_RSVP notification only when transitioning to GOING for the first time. Skips if RSVPer is the event creator.

### Validation
- `tsc --noEmit` â†’ 0 errors âœ…
- `npm run lint` â†’ 0 errors, 4 warnings (intentional `_formData` params) âœ…
- `prisma generate` â†’ client regenerated with Notification model âœ…
- Migration needs local `prisma migrate deploy` after DB is running
